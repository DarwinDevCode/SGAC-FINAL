<div class="h-[calc(100vh-8rem)] flex flex-col gap-6 animate-fade-in" *ngIf="convocatoria()">

    <!-- Header -->
    <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
            <button routerLink="/coordinator/convocatorias"
                class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                <lucide-icon [img]="ArrowLeft" class="w-6 h-6 text-gray-500"></lucide-icon>
            </button>
            <div>
                <h1 class="text-2xl font-bold text-gray-800">{{ convocatoria()?.nombreAsignatura }}</h1>
                <p class="text-sm text-gray-500">{{ convocatoria()?.nombrePeriodo }}</p>
            </div>
        </div>
        <app-status-chip [status]="convocatoria()?.estado!" type="CONVOCATORIA"></app-status-chip>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 flex-1 overflow-hidden">

        <!-- Left: Details & Commission -->
        <div class="lg:col-span-1 flex flex-col gap-6 overflow-y-auto pr-2">

            <!-- Details Card -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <h3 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <lucide-icon [img]="FileText" class="w-5 h-5 text-primary"></lucide-icon>
                    Detalles
                </h3>
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between border-b pb-2">
                        <span class="text-gray-500">Vacantes</span>
                        <span class="font-medium">{{ convocatoria()?.cuposDisponibles }}</span>
                    </div>
                    <div class="flex justify-between border-b pb-2">
                        <span class="text-gray-500">Inicio</span>
                        <span class="font-medium">{{ convocatoria()?.fechaPublicacion }}</span>
                    </div>
                    <div class="flex justify-between border-b pb-2">
                        <span class="text-gray-500">Fin</span>
                        <span class="font-medium">{{ convocatoria()?.fechaCierre }}</span>
                    </div>
                </div>
            </div>

            <!-- Commission Card -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-gray-800 flex items-center gap-2">
                        <lucide-icon [img]="Users" class="w-5 h-5 text-primary"></lucide-icon>
                        Comisión
                    </h3>
                    <button (click)="openAddMemberModal()"
                        class="text-sm text-primary font-medium hover:underline flex items-center gap-1">
                        <lucide-icon [img]="UserPlus" class="w-4 h-4"></lucide-icon>
                        Agregar
                    </button>
                </div>

                <div class="space-y-3">
                    <div *ngFor="let m of comision()"
                        class="flex items-center justify-between p-3 bg-gray-50 rounded-lg group">
                        <div>
                            <p class="font-medium text-gray-800 text-sm">{{ m.nombre }}</p>
                            <p class="text-xs text-gray-500">{{ m.rol }}</p>
                        </div>
                        <button (click)="removeMember(m.idUsuario)"
                            class="text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity">
                            <lucide-icon [img]="Trash2" class="w-4 h-4"></lucide-icon>
                        </button>
                    </div>
                    <div *ngIf="comision().length === 0" class="text-center text-sm text-gray-400 py-4 italic">
                        No hay miembros asignados.
                    </div>
                </div>
            </div>

        </div>

        <!-- Right: Process & Results -->
        <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-200 p-6 flex flex-col">
            <h3 class="font-bold text-gray-800 mb-6 flex items-center gap-2">
                <lucide-icon [img]="CheckCircle" class="w-5 h-5 text-primary"></lucide-icon>
                Consolidación de Resultados
            </h3>

            <!-- Results Table (Placeholder) -->
            <div class="flex-1 rounded-lg border border-gray-100 overflow-hidden mb-6">
                <table class="w-full text-sm text-left">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 font-semibold text-gray-700">Postulante</th>
                            <th class="px-4 py-3 font-semibold text-gray-700 text-right">Méritos</th>
                            <th class="px-4 py-3 font-semibold text-gray-700 text-right">Oposición</th>
                            <th class="px-4 py-3 font-semibold text-gray-700 text-right">Total</th>
                            <th class="px-4 py-3 font-semibold text-gray-700 text-center">Estado</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                        <!-- Mock Data -->
                        <tr class="hover:bg-gray-50">
                            <td class="px-4 py-3 font-medium">Estudiante #1</td>
                            <td class="px-4 py-3 text-right">18.5</td>
                            <td class="px-4 py-3 text-right">19.0</td>
                            <td class="px-4 py-3 text-right font-bold text-gray-900">37.5</td>
                            <td class="px-4 py-3 text-center">
                                <span
                                    class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-semibold">Ganador</span>
                            </td>
                        </tr>
                        <tr class="hover:bg-gray-50">
                            <td class="px-4 py-3 font-medium">Estudiante #2</td>
                            <td class="px-4 py-3 text-right">15.0</td>
                            <td class="px-4 py-3 text-right">16.0</td>
                            <td class="px-4 py-3 text-right font-bold text-gray-900">31.0</td>
                            <td class="px-4 py-3 text-center">
                                <span
                                    class="px-2 py-1 bg-gray-100 text-gray-600 rounded text-xs font-semibold">Apto</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Actions -->
            <div class="bg-gray-50 p-4 rounded-lg flex items-center justify-between border border-gray-200">
                <div class="text-sm text-gray-600">
                    <p class="font-medium">Acción Requerida:</p>
                    <p>Una vez finalizada la evaluación, consolide los resultados para enviarlos a aprobación del
                        Decano.</p>
                </div>
                <button (click)="approveResults()"
                    class="px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 font-medium flex items-center gap-2 shadow-sm transition-colors">
                    <lucide-icon [img]="Send" class="w-4 h-4"></lucide-icon>
                    Enviar a Decano
                </button>
            </div>

        </div>

    </div>

</div>

<!-- Add Member Modal -->
<div *ngIf="showAddMemberModal"
    class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 animate-fade-in">
    <div class="bg-white rounded-xl shadow-xl max-w-sm w-full p-6 space-y-4">
        <h3 class="text-lg font-bold text-gray-800">Agregar Miembro</h3>

        <div class="space-y-3">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Docente</label>
                <select [(ngModel)]="selectedDocenteId"
                    class="w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary py-2 px-3 border">
                    <option [value]="0">Seleccione...</option>
                    <option *ngFor="let d of availableDocentes()" [value]="d.id">{{ d.nombre }}</option>
                </select>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Rol</label>
                <select [(ngModel)]="selectedRole"
                    class="w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary py-2 px-3 border">
                    <option value="PRESIDENTE">Presidente</option>
                    <option value="MIEMBRO">Miembro</option>
                    <option value="SECRETARIO">Secretario</option>
                </select>
            </div>
        </div>

        <div class="flex justify-end gap-3 pt-4">
            <button (click)="showAddMemberModal = false"
                class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg font-medium">Cancelar</button>
            <button (click)="addMember()" [disabled]="!selectedDocenteId"
                class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 font-medium disabled:opacity-50">
                Agregar
            </button>
        </div>
    </div>
</div>
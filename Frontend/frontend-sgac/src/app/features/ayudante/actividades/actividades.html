<div class="gestion-container max-w-6xl mx-auto">
    <div
        class="section-header flex justify-between items-center bg-white p-6 rounded-2xl shadow-sm border border-slate-100 mb-8">
        <div class="title-container">
            <div class="flex items-center gap-3">
                <a routerLink="/ayudante/dashboard"
                    class="back-btn flex items-center justify-center bg-slate-50 hover:bg-slate-100 p-2 rounded-full text-slate-500 transition-colors decoration-none">
                    <lucide-icon name="arrow-left" size="18"></lucide-icon>
                </a>
                <h2 class="title text-2xl font-black text-slate-800 m-0">Registro de Actividades</h2>
            </div>
            <p class="subtitle mt-1 ml-10">Bitácora diaria de tu labor como ayudante.</p>
        </div>

        @if (ayudantia) {
        <div class="hidden md:flex flex-col items-end">
            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Ayudantía ID</span>
            <span class="font-mono text-indigo-600 font-bold">#{{ ayudantia.idAyudantia }}</span>
        </div>
        }
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

        <!-- Form Side -->
        <div class="lg:col-span-4">
            <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden sticky top-6">
                <div class="p-5 border-b border-slate-50 flex items-center gap-2">
                    <lucide-icon name="pencil-line" size="18" class="text-indigo-600"></lucide-icon>
                    <span class="font-bold text-slate-800">Nueva Sesión</span>
                </div>

                <form [formGroup]="actividadForm" (ngSubmit)="onSubmit()" class="p-6 space-y-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Tema Tratado</label>
                        <input type="text" formControlName="temaTratado" placeholder="Ej: Clase de repaso sobre Bucles"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none transition-all text-sm">
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Descripción</label>
                        <textarea formControlName="descripcionActividad" rows="3"
                            placeholder="Detalla qué hiciste hoy..."
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none transition-all text-sm resize-none"></textarea>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Fecha</label>
                            <input type="date" formControlName="fecha"
                                class="w-full px-4 py-3 rounded-xl border border-slate-200 text-sm outline-none">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Horas</label>
                            <input type="number" step="0.5" formControlName="horasDedicadas"
                                class="w-full px-4 py-3 rounded-xl border border-slate-200 text-sm outline-none">
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Asistentes <span
                                class="text-slate-300 font-normal ml-1">(Opcional)</span></label>
                        <input type="number" formControlName="numeroAsistentes"
                            class="w-full px-4 py-3 rounded-xl border border-slate-200 text-sm outline-none">
                    </div>

                    <button type="submit" [disabled]="actividadForm.invalid || loadingForm"
                        class="w-full bg-indigo-600 hover:bg-slate-900 text-white font-bold py-4 rounded-xl mt-4 transition-all flex items-center justify-center gap-2 group disabled:opacity-50 disabled:cursor-not-allowed">
                        <lucide-icon name="save" size="18" [class.animate-bounce]="loadingForm"></lucide-icon>
                        {{ loadingForm ? 'Guardando...' : 'Registrar Actividad' }}
                    </button>
                </form>

                @if (successMensaje) {
                <div
                    class="mx-6 mb-6 p-3 bg-emerald-50 text-emerald-700 text-xs font-bold rounded-lg flex items-center gap-2 animate-in fade-in slide-in-from-bottom-2">
                    <lucide-icon name="check-circle" size="14"></lucide-icon> {{ successMensaje }}
                </div>
                }
            </div>
        </div>

        <!-- History Side -->
        <div class="lg:col-span-8">
            <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden min-h-[500px]">
                <div class="p-5 border-b border-slate-50 flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <lucide-icon name="history" size="18" class="text-indigo-600"></lucide-icon>
                        <span class="font-bold text-slate-800">Historial de Registros</span>
                    </div>
                    <span class="text-xs font-medium text-slate-400">{{ actividades.length }} registros en total</span>
                </div>

                @if (loading) {
                <div class="flex flex-col items-center justify-center h-full py-20 text-slate-400">
                    <lucide-icon name="loader-2" class="animate-spin mb-4" size="40"></lucide-icon>
                    <p>Obteniendo actividades...</p>
                </div>
                } @else if (errorMensaje) {
                <div class="p-20 text-center">
                    <lucide-icon name="alert-circle" size="40" class="text-rose-400 mx-auto mb-4"></lucide-icon>
                    <p class="text-rose-600 font-bold m-0 uppercase text-xs tracking-widest">Atención</p>
                    <p class="text-slate-500 mt-2 text-sm">{{ errorMensaje }}</p>
                </div>
                } @else {
                <div class="divide-y divide-slate-100">
                    @for (act of actividades; track act.idRegistroActividad) {
                    <div class="p-6 hover:bg-slate-50 transition-colors flex items-start gap-4 group">
                        <div class="flex flex-col items-center min-w-[60px] pt-1">
                            <span class="text-lg font-black text-slate-700 leading-none">{{ act.fecha | date:'dd'
                                }}</span>
                            <span class="text-[10px] uppercase font-bold text-slate-400 tracking-tighter">{{ act.fecha |
                                date:'MMM' }}</span>
                        </div>

                        <div class="flex-grow">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="font-bold text-slate-800 m-0 text-sm uppercase tracking-tight">{{
                                    act.temaTratado }}</h4>
                                <span
                                    class="px-2 py-0.5 rounded text-[10px] font-black tracking-widest uppercase border border-slate-200 text-slate-400 group-hover:bg-indigo-600 group-hover:text-white group-hover:border-indigo-600 transition-all cursor-default">
                                    {{ act.horasDedicadas }}h
                                </span>
                            </div>
                            <p class="text-sm text-slate-500 m-0 leading-relaxed">{{ act.descripcionActividad }}</p>

                            <div class="flex items-center gap-4 mt-4">
                                @if (act.numeroAsistentes > 0) {
                                <div
                                    class="flex items-center gap-1 text-[10px] font-bold text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded">
                                    <lucide-icon name="users" size="10"></lucide-icon>
                                    {{ act.numeroAsistentes }} Asistentes
                                </div>
                                }
                                <span class="text-[10px] font-bold text-indigo-400 flex items-center gap-1">
                                    <lucide-icon name="clock" size="10"></lucide-icon>
                                    {{ act.estadoRevision || 'REGISTRADO' }}
                                </span>
                            </div>
                        </div>

                        <div class="opacity-0 group-hover:opacity-100 transition-opacity">
                            <button (click)="eliminar(act.idRegistroActividad)"
                                class="text-rose-400 hover:text-rose-600 p-2 rounded-lg hover:bg-rose-50 transition-all">
                                <lucide-icon name="trash-2" size="16"></lucide-icon>
                            </button>
                        </div>
                    </div>
                    } @empty {
                    <div class="p-20 text-center flex flex-col items-center">
                        <div class="bg-slate-50 p-6 rounded-full mb-4 text-slate-300">
                            <lucide-icon name="ghost" size="48"></lucide-icon>
                        </div>
                        <h4 class="text-slate-800 font-bold m-0">Sin Actividades</h4>
                        <p class="text-slate-400 text-sm mt-1 max-w-[240px]">Aún no has registrado ninguna sesión de
                            ayudantía. ¡Empieza hoy!</p>
                    </div>
                    }
                </div>
                }
            </div>
        </div>

    </div>
</div>
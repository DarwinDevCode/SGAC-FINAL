<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in"
     (click)="onClose()">
  <div class="bg-white rounded-xl w-full max-w-2xl shadow-2xl flex flex-col max-h-[90vh]"
       (click)="$event.stopPropagation()">

    <div class="flex items-center justify-between border-b p-6">
      <div>
        <h2 class="text-xl font-bold text-gray-900">
          {{ convocatoria ? 'Editar Convocatoria' : 'Nueva Convocatoria' }}
        </h2>
        <p class="text-sm text-gray-500">Complete la información para {{ convocatoria ? 'actualizar' : 'abrir'
          }} un concurso.</p>
      </div>
      <button (click)="onClose()" class="p-2 hover:bg-gray-100 rounded-full text-gray-500">
        <lucide-icon [img]="X" [size]="20"></lucide-icon>
      </button>
    </div>

    <div class="p-6 overflow-y-auto space-y-6 relative">

      @if (loadingData()) {
        <div class="absolute inset-0 bg-white/80 z-10 flex items-center justify-center">
          <div class="flex items-center gap-2 text-primary">
            <span class="animate-spin h-5 w-5 border-2 border-primary border-t-transparent rounded-full"></span>
            Cargando recursos...
          </div>
        </div>
      }

      <form (ngSubmit)="onSubmit()" class="space-y-6">

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

          <div class="space-y-2">
            <label class="text-sm font-medium text-gray-700 flex items-center gap-2">
              <lucide-icon [img]="Calendar" [size]="16"></lucide-icon>
              Periodo Académico
            </label>
            <input type="text" [value]="form().nombrePeriodo" disabled
                   class="w-full bg-gray-100 border border-gray-300 rounded-lg px-3 py-2 text-gray-500 cursor-not-allowed font-medium"
                   placeholder="Cargando periodo..." />
          </div>

          <div class="space-y-2">
            <label class="text-sm font-medium text-gray-700 flex items-center gap-2">
              <lucide-icon [img]="GraduationCap" [size]="16"></lucide-icon>
              Docente Responsable
            </label>
            <select [(ngModel)]="form().idDocente" name="idDocente"
                    class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/20 focus:border-primary bg-white">
              <option [value]="0" disabled>Seleccione un docente</option>
              @for (doc of docentesList(); track doc.idDocente) {
                <option [value]="doc.idDocente">{{ doc.nombreCompletoUsuario }}</option>
              }
            </select>
          </div>

          <div class="space-y-2 md:col-span-2">
            <label class="text-sm font-medium text-gray-700 flex items-center gap-2">
              <lucide-icon [img]="BookOpen" [size]="16"></lucide-icon>
              Asignatura / Cátedra
            </label>
            <select [(ngModel)]="form().idAsignatura" name="idAsignatura"
                    class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/20 focus:border-primary bg-white">
              <option [value]="0" disabled>Seleccione la asignatura</option>
              @for (asig of asignaturasList(); track asig.idAsignatura) {
                <option [value]="asig.idAsignatura">
                  {{ asig.nombreAsignatura }} ({{ asig.nombreCarrera }} - Semestre {{ asig.semestre }})
                </option>
              }
            </select>
          </div>
        </div>

        <div class="border-t border-gray-100 my-2"></div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

          <div class="space-y-2">
            <label class="text-sm font-medium text-gray-700 flex items-center gap-2">
              <lucide-icon [img]="Users" [size]="16"></lucide-icon>
              Vacantes
            </label>
            <input type="number" min="1" [(ngModel)]="form().vacantes" name="vacantes"
                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/20" />
          </div>

          <div class="space-y-2">
            <label class="text-sm font-medium text-gray-700">Fecha Inicio</label>
            <input type="date" [(ngModel)]="form().fechaInicio" name="fechaInicio"
                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/20" />
          </div>

          <div class="space-y-2">
            <label class="text-sm font-medium text-gray-700">Fecha Cierre</label>
            <input type="date" [(ngModel)]="form().fechaFin" name="fechaFin"
                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/20" />
          </div>
        </div>

        <div class="space-y-2">
          <label class="text-sm font-medium text-gray-700">Estado</label>
          <select [(ngModel)]="form().estado" name="estado"
                  class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary/20 focus:border-primary bg-white">
            <option value="ABIERTA">Abierta</option>
            <option value="CERRADA">Cerrada</option>
            <option value="EN_PROCESO">En Proceso</option>
          </select>
        </div>

      </form>

    </div>

    <div class="border-t p-6 bg-gray-50 flex justify-end gap-3 rounded-b-xl">
      <button (click)="onClose()"
              class="px-4 py-2 text-sm font-medium border rounded-lg hover:bg-gray-100 text-gray-700">
        Cancelar
      </button>
      <button (click)="onSubmit()" [disabled]="loading() || loadingData()"
              class="px-6 py-2 text-sm font-medium text-white bg-primary rounded-lg hover:bg-primary/90 flex items-center gap-2 shadow-sm disabled:opacity-50">
        @if (loading()) {
          <span class="animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"></span>
        } @else {
          <lucide-icon [img]="Save" [size]="16"></lucide-icon>
        }
        {{ convocatoria ? 'Actualizar' : 'Guardar' }} Convocatoria
      </button>
    </div>

  </div>
</div>

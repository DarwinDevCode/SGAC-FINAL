<div class="max-w-4xl mx-auto py-8 space-y-8 animate-fade-in">

  <!-- Header -->
  <div class="space-y-2">
    <h1 class="text-3xl font-bold text-gray-900">Nueva Postulación</h1>
    <p class="text-gray-500" *ngIf="convocatoria()">
      {{ convocatoria()?.nombreAsignatura }} - {{ convocatoria()?.nombrePeriodo }}
    </p>
  </div>

  <!-- Stepper -->
  <app-stepper [steps]="STEPS" [currentStep]="currentStep()"></app-stepper>

  <!-- Step Content -->
  <div class="bg-white border border-gray-200 rounded-xl shadow-sm p-6 min-h-[400px] flex flex-col">

    <!-- Step 1: Requirements Info -->
    <div *ngIf="currentStep() === 0" class="space-y-6">
      <h2 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
        <lucide-icon [img]="CheckCircle" class="text-primary"></lucide-icon>
        Requisitos Previos
      </h2>
      <p class="text-gray-600">
        Antes de continuar, asegúrate de cumplir con los siguientes requisitos y tener los documentos digitales listos
        (PDF).
      </p>

      <ul class="space-y-3">
        <li *ngFor="let req of requisitos()"
          class="flex items-start gap-3 p-3 rounded-lg bg-gray-50 border border-gray-100">
          <lucide-icon [img]="FileText" class="w-5 h-5 text-gray-400 mt-0.5 flex-shrink-0"></lucide-icon>
          <div>
            <span class="font-medium text-gray-900 block">{{ req.nombre }}</span>
            <span class="text-sm text-gray-500">{{ req.descripcion }}</span>
          </div>
        </li>
      </ul>

      <div class="bg-blue-50 border border-blue-100 p-4 rounded-lg flex gap-3 text-blue-700 text-sm mt-6">
        <lucide-icon [img]="AlertCircle" class="w-5 h-5 flex-shrink-0"></lucide-icon>
        <p>Aseguúrate de que tus archivos sean legibles y no superen los 5MB cada uno.</p>
      </div>
    </div>

    <!-- Step 2: Documents Upload -->
    <div *ngIf="currentStep() === 1" class="space-y-6">
      <h2 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
        <lucide-icon [img]="Upload" class="text-primary"></lucide-icon>
        Subir Documentos
      </h2>

      <div class="space-y-4">
        <div *ngFor="let req of requisitos()"
          class="bg-white border border-gray-200 rounded-lg p-4 hover:border-primary/50 transition-colors">
          <label class="block mb-2 font-medium text-gray-900">
            {{ req.nombre }} <span class="text-red-500">*</span>
          </label>
          <p class="text-xs text-gray-500 mb-3">{{ req.descripcion }}</p>

          <div class="flex items-center gap-4">
            <input type="file" (change)="onFileSelected($event, req.idTipoRequisito)" accept=".pdf,.jpg,.png" class="block w-full text-sm text-gray-500
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-full file:border-0
                        file:text-sm file:font-semibold
                        file:bg-primary-50 file:text-primary-700
                        hover:file:bg-primary-100
                      " />

            <div *ngIf="getFile(req.idTipoRequisito)" class="flex items-center text-green-600 text-sm animate-fade-in">
              <lucide-icon [img]="CheckCircle" class="w-4 h-4 mr-1"></lucide-icon>
              Listo
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Step 3: Confirmation -->
    <div *ngIf="currentStep() === 2" class="space-y-6">
      <h2 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
        <lucide-icon [img]="CheckCircle" class="text-primary"></lucide-icon>
        Confirmar Postulación
      </h2>

      <div class="bg-gray-50 rounded-lg p-4 space-y-4">
        <h3 class="font-medium text-gray-900">Resumen de documentos adjuntos:</h3>
        <ul class="space-y-2">
          <li *ngFor="let req of requisitos()" class="flex items-center justify-between text-sm">
            <span class="text-gray-600">{{ req.nombre }}</span>
            <span class="font-medium text-gray-900">{{ getFile(req.idTipoRequisito)?.name }}</span>
          </li>
        </ul>
      </div>

      <div [formGroup]="form" class="space-y-2">
        <label class="block font-medium text-gray-700">Observaciones (Opcional)</label>
        <textarea formControlName="observaciones" rows="3"
          class="w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary sm:text-sm p-3 border"
          placeholder="Alguna nota adicional para la comisión..."></textarea>
      </div>

      <div class="bg-yellow-50 border border-yellow-100 p-4 rounded-lg flex gap-3 text-yellow-800 text-sm">
        <lucide-icon [img]="AlertCircle" class="w-5 h-5 flex-shrink-0"></lucide-icon>
        <p>Al hacer clic en "Enviar Postulación", declaras que toda la información proporcionada es verídica.</p>
      </div>
    </div>

    <!-- Footer Actions -->
    <div class="mt-auto pt-8 flex justify-between border-t border-gray-100">
      <button *ngIf="currentStep() > 0" (click)="prevStep()"
        class="px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 font-medium flex items-center gap-2">
        <lucide-icon [img]="ArrowLeft" class="w-4 h-4"></lucide-icon>
        Atrás
      </button>
      <div *ngIf="currentStep() === 0"></div> <!-- Spacer -->

      <button *ngIf="currentStep() < STEPS.length - 1" (click)="nextStep()"
        [disabled]="currentStep() === 1 && !canProceedToConfirm"
        class="ml-auto px-6 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 font-medium flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
        Siguiente
        <lucide-icon [img]="ArrowRight" class="w-4 h-4"></lucide-icon>
      </button>

      <button *ngIf="currentStep() === STEPS.length - 1" (click)="onSubmit()" [disabled]="loading()"
        class="ml-auto px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 font-medium flex items-center gap-2 disabled:opacity-50">
        <span *ngIf="loading()"
          class="animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full mr-2"></span>
        Enviar Postulación
      </button>
    </div>

  </div>
</div>